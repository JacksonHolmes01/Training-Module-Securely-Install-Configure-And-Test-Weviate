services:
  weaviate:
    # Pin to a stable version (avoid :latest pulling RC/nightly builds)
    image: semitechnologies/weaviate:1.24.12
    container_name: weaviate
    restart: unless-stopped

    # Resource limits (protects your machine)
    mem_limit: 2g
    cpus: 2.0
    pids_limit: 256

    ports:
      - "127.0.0.1:8080:8080"
      - "127.0.0.1:50051:50051"

    environment:
      # Force single-node behavior (prevents "leader not found" / raft issues)
      CLUSTER_HOSTNAME: "node1"
      RAFT_ENABLED: "false"

      PERSISTENCE_DATA_PATH: "/var/lib/weaviate"
      QUERY_DEFAULTS_LIMIT: "25"

      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: "false"
      AUTHENTICATION_APIKEY_ENABLED: "true"
      AUTHENTICATION_APIKEY_ALLOWED_KEYS: "admin-key-123,viewer-key-123"
      AUTHENTICATION_APIKEY_USERS: "admin-user,viewer-user"

      AUTHORIZATION_RBAC_ENABLED: "true"
      AUTHORIZATION_RBAC_ROOT_USERS: "admin-user"

      ENABLE_MODULES: "backup-filesystem"
      BACKUP_FILESYSTEM_PATH: "/tmp/backups"

    volumes:
      - weaviate_data:/var/lib/weaviate
      - ./backups:/tmp/backups

volumes:
  weaviate_data:

